<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .tree ul {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            padding-top: 20px;
            position: relative;
            transition: transform 0.3s ease-in-out;
        }
        .tree ul::before, .tree ul::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 2px solid #6b7280;
            height: 20px;
            transform: translateX(-50%);
        }
        .tree li {
            position: relative;
            padding: 10px 5px 0 5px;
            text-align: center;
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .tree li::before, .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 2px solid #6b7280;
            width: 50%;
            height: 20px;
        }
        .tree li::after {
            left: 50%;
            border-left: 2px solid #6b7280;
        }
        .tree li:only-child::after, .tree li:only-child::before {
            display: none;
        }
        .tree li:only-child {
            padding-top: 0;
        }
        .tree li:first-child::before, .tree li:last-child::after {
            border: 0 none;
        }
        .tree li:last-child::before {
            border-right: 2px solid #6b7280;
            border-radius: 0 5px 0 0;
        }
        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
        }
        .tree ul ul::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            border-left: 2px solid #6b7280;
            height: 20px;
            z-index: 10;
        }
        .person {
            background-color: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 2px solid #d1d5db;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            /* Optimized for mobile: let flexbox handle width */
            flex-shrink: 0;
            z-index: 20;
            width: 150px;
        }
        .person input[type="text"] {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 100%;
        }
        .person button {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .person button:hover {
            background-color: #1d4ed8;
        }
        .relation-text {
            color: #4b5563;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        .tree-container {
            overflow-x: auto;
            padding: 1rem 0; /* Adjusted for better mobile padding */
            display: flex;
            justify-content: center;
        }

        /* Mobile-first adjustments */
        @media (max-width: 640px) {
            .person {
                width: 120px; /* Smaller cards for mobile */
                padding: 0.75rem;
            }
            .person input[type="text"] {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8 sm:mb-12">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Family Tree Builder</h1>
            <p class="text-gray-600 mt-2">Enter names and build your family tree. Select "This is me" to see the relationships!</p>
        </div>

        <div class="flex justify-center items-center gap-4 mb-8">
            <button id="exportButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105">
                Export Tree
            </button>
        </div>

        <div id="treeContainer" class="tree-container">
            <div id="tree" class="tree"></div>
        </div>
    </div>

    <script type="module">
        // Helper function to create a unique ID
        const generateId = () => Math.random().toString(36).substring(2, 9);

        // Class to represent a person in the family tree
        class Person {
            constructor(name = '', parentId = null) {
                this.id = generateId();
                this.name = name;
                this.parentId = parentId;
                this.children = [];
            }
        }

        let familyTreeData = new Person('Grandma & Grandpa');
        let meId = null;

        // Initialize the tree with 7 children as requested
        for (let i = 0; i < 7; i++) {
            familyTreeData.children.push(new Person('Child ' + (i + 1), familyTreeData.id));
        }

        const treeElement = document.getElementById('tree');
        const exportButton = document.getElementById('exportButton');

        // Function to find a person in the tree by their ID
        const findPersonById = (id, node = familyTreeData) => {
            if (node.id === id) return node;
            for (const child of node.children) {
                const found = findPersonById(child, id);
                if (found) return found;
            }
            return null;
        };

        // Function to find the path from a person to the root
        const findPathToRoot = (id, node = familyTreeData, path = []) => {
            if (node.id === id) {
                path.push(node);
                return path;
            }
            for (const child of node.children) {
                const foundPath = findPathToRoot(child, id, path);
                if (foundPath) {
                    foundPath.push(node);
                    return foundPath;
                }
            }
            return null;
        };

        // Function to get the relationship between two people
        const getRelationship = (person1, person2) => {
            if (!person1 || !person2 || person1.id === person2.id) {
                return 'This is me!';
            }

            const path1 = findPathToRoot(person1.id);
            const path2 = findPathToRoot(person2.id);

            // Find the lowest common ancestor
            let lca = null;
            let i = path1.length - 1;
            let j = path2.length - 1;
            while (i >= 0 && j >= 0 && path1[i].id === path2[j].id) {
                lca = path1[i];
                i--;
                j--;
            }

            const depth1 = path1.length - 1;
            const depth2 = path2.length - 1;
            const lcaDepth = findPathToRoot(lca.id).length - 1;

            const dist1 = depth1 - lcaDepth;
            const dist2 = depth2 - lcaDepth;

            // Same generation
            if (dist1 === dist2) {
                if (dist1 === 1) { // Same parents
                    return 'Sibling';
                }
                if (dist1 === 2) { // Grandparents are LCA
                    return '1st Cousin';
                }
                if (dist1 === 3) {
                    return '2nd Cousin';
                }
                if (dist1 === 4) {
                    return '3rd Cousin';
                }
                return `${dist1 - 1}th Cousin`; // Fallback for higher cousins
            }

            // Different generations
            if (dist1 === 0) { // person1 is an ancestor of person2
                if (dist2 === 1) return 'Parent';
                if (dist2 === 2) return 'Grandparent';
                if (dist2 === 3) return 'Great Grandparent';
                return `${dist2 - 1}x Great Grandparent`;
            }

            if (dist2 === 0) { // person2 is an ancestor of person1
                if (dist1 === 1) return 'Child';
                if (dist1 === 2) return 'Grandchild';
                if (dist1 === 3) return 'Great Grandchild';
                return `${dist1 - 1}x Great Grandchild`;
            }

            // Aunt/Uncle logic
            if (dist1 === 1) {
                if (dist2 === 2) return 'Nephew/Niece';
                if (dist2 === 3) return 'Grandnephew/Grandniece';
            }
            if (dist2 === 1) {
                if (dist1 === 2) return 'Aunt/Uncle';
                if (dist1 === 3) return 'Great Aunt/Uncle';
            }

            // Cousin with 'removed' logic
            const removed = Math.abs(dist1 - dist2);
            const cousinNumber = Math.min(dist1, dist2) - 1;

            if (removed === 0) {
                 if (cousinNumber === 1) return 'Sibling';
                 return `${cousinNumber}th Cousin`;
            }
            if (removed > 0) {
                if (cousinNumber === 0) {
                    return removed === 1 ? 'Aunt/Uncle' : `${removed-1}x Great Aunt/Uncle`;
                }
                return `${cousinNumber}nd Cousin, ${removed}x Removed`;
            }
            return 'Relative';
        };

        // Function to recursively render the tree
        const renderTree = (data, parentEl) => {
            const ul = document.createElement('ul');
            parentEl.appendChild(ul);

            data.children.forEach(person => {
                const li = document.createElement('li');
                li.setAttribute('data-id', person.id);

                const personDiv = document.createElement('div');
                personDiv.className = 'person';

                // Name input field
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.placeholder = 'Enter name';
                nameInput.value = person.name;
                nameInput.className = 'text-center';
                nameInput.addEventListener('input', (e) => {
                    person.name = e.target.value;
                    updateRelationships();
                });
                personDiv.appendChild(nameInput);

                // Relationship text field
                const relationText = document.createElement('p');
                relationText.className = 'relation-text';
                personDiv.appendChild(relationText);

                // Checkbox for "This is me"
                const checkboxWrapper = document.createElement('div');
                checkboxWrapper.className = 'flex items-center gap-2 mt-2';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500';
                checkbox.checked = meId === person.id;
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        meId = person.id;
                        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                            if (cb !== e.target) {
                                cb.checked = false;
                            }
                        });
                    } else {
                        meId = null;
                    }
                    updateRelationships();
                });
                checkboxWrapper.appendChild(checkbox);

                const checkboxLabel = document.createElement('span');
                checkboxLabel.textContent = 'This is me';
                checkboxLabel.className = 'text-sm text-gray-600';
                checkboxWrapper.appendChild(checkboxLabel);
                personDiv.appendChild(checkboxWrapper);

                // Add child button
                const addButton = document.createElement('button');
                addButton.textContent = 'Add Child';
                addButton.className = 'mt-2';
                addButton.addEventListener('click', () => {
                    const newChild = new Person('', person.id);
                    person.children.push(newChild);
                    render();
                });
                personDiv.appendChild(addButton);

                li.appendChild(personDiv);

                if (person.children.length > 0) {
                    renderTree(person, li);
                }

                ul.appendChild(li);
            });
        };

        // Function to update the relationship text for all people
        const updateRelationships = () => {
            const allPeople = document.querySelectorAll('.person');
            allPeople.forEach(el => {
                const id = el.closest('li').getAttribute('data-id');
                const person = findPersonById(id);
                const relationEl = el.querySelector('.relation-text');

                if (meId) {
                    const mePerson = findPersonById(meId);
                    const relation = getRelationship(person, mePerson);
                    relationEl.textContent = relation;
                    relationEl.style.display = 'block';
                } else {
                    relationEl.textContent = '';
                    relationEl.style.display = 'none';
                }
            });
        };

        // The main render function
        const render = () => {
            treeElement.innerHTML = '';
            const rootLi = document.createElement('li');
            const rootDiv = document.createElement('div');
            rootDiv.className = 'person';
            rootDiv.setAttribute('data-id', familyTreeData.id);

            const rootNameInput = document.createElement('input');
            rootNameInput.type = 'text';
            rootNameInput.placeholder = 'Enter name';
            rootNameInput.value = familyTreeData.name;
            rootNameInput.className = 'text-center';
            rootNameInput.addEventListener('input', (e) => {
                familyTreeData.name = e.target.value;
                updateRelationships();
            });
            rootDiv.appendChild(rootNameInput);

            const rootRelationText = document.createElement('p');
            rootRelationText.className = 'relation-text';
            rootDiv.appendChild(rootRelationText);

            const rootAddButton = document.createElement('button');
            rootAddButton.textContent = 'Add Child';
            rootAddButton.className = 'mt-2';
            rootAddButton.addEventListener('click', () => {
                const newChild = new Person('', familyTreeData.id);
                familyTreeData.children.push(newChild);
                render();
            });
            rootDiv.appendChild(rootAddButton);

            rootLi.appendChild(rootDiv);
            treeElement.appendChild(rootLi);

            if (familyTreeData.children.length > 0) {
                renderTree(familyTreeData, rootLi);
            }

            updateRelationships();
        };

        // Export button functionality
        exportButton.addEventListener('click', () => {
            const dataStr = JSON.stringify(familyTreeData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'family_tree.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Initial render
        render();

    </script>
</body>
</html>
